<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculator</title>
    <link rel="stylesheet" href="css/all.css">
    <link rel="stylesheet" href="css/bulb.css">
    <link rel="stylesheet" href="css/calculator.css">
</head>
<body>
    <nav>
        <a href="index.html">
            <svg fill="#fff" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" stroke="#fff"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M222.927 580.115l301.354 328.512c24.354 28.708 20.825 71.724-7.883 96.078s-71.724 20.825-96.078-7.883L19.576 559.963a67.846 67.846 0 01-13.784-20.022 68.03 68.03 0 01-5.977-29.488l.001-.063a68.343 68.343 0 017.265-29.134 68.28 68.28 0 011.384-2.6 67.59 67.59 0 0110.102-13.687L429.966 21.113c25.592-27.611 68.721-29.247 96.331-3.656s29.247 68.721 3.656 96.331L224.088 443.784h730.46c37.647 0 68.166 30.519 68.166 68.166s-30.519 68.166-68.166 68.166H222.927z"></path></g></svg>
        </a>
        <h1>
            <div class='bulb-board'>Analyze</div>
        </h1>
    </nav>
    <section style="overflow: hidden;">
        <form id="operationform" method="post" action="operation.php">
            <div class="parameter">
                <div class="input-box">
                    <label for="num1">Deposit:</label>
                    <input type="number" id="num1">
                    <lottie-player class="svg-box" src="https://assets4.lottiefiles.com/packages/lf20_EtVMC4WXos.json" background="transparent" speed="1" loop autoplay></lottie-player>
                </div>

                <div class="input-box">
                    <label for="num2">Bonus:</label>
                    <input type="number" id="num2">
                    <lottie-player class="svg-box" src="https://assets2.lottiefiles.com/packages/lf20_zywherkr.json" background="transparent" speed="1" loop autoplay></lottie-player>
                </div>
                
                <div class="input-box">
                    <label for="num3">turn:</label>
                    <input type="number" id="num3">
                    <lottie-player class="svg-box" src="https://assets10.lottiefiles.com/packages/lf20_Jpn5Hs3tsy.json" background="transparent" speed="1" loop autoplay></lottie-player>
                </div>
            </div>
            <div class="btn-box">
                <button class="sumbit" type="submit">Sumbit</button>
                <!-- <input class="sumbit" type="button" name="submit" value="提交" /> -->
            </div>
        </form>
        
        <div class="conclusion">
            <div class="pass-box">
                <!-- <label for="result">過關率:</label> -->
                <svg class="circle-box" width="160" height="160">
                    <defs>
                        <linearGradient id="myGradient" x1="0%" y1="0%" x2="0%" y2="100%" spreadMethod="pad">
                            <stop offset="0%"   stop-color="#d9ad34" stop-opacity="1"/>
                            <stop offset="30%" stop-color="#FFFFA4" stop-opacity="1"/>
                            <stop offset="50%"   stop-color="#d9ad34" stop-opacity="1"/>
                            <stop offset="90%" stop-color="#bf7427" stop-opacity="1"/>
                            <stop offset="100%" stop-color="#FFFFA4" stop-opacity="1"/>
                        </linearGradient>
                    </defs>
                    <circle class="" fill="none" stroke="#ccc" stroke-width="8" cx="80" cy="80" r="76" stroke-linecap="round" />
                    <circle class="circle" fill="none" stroke="url(#myGradient)" stroke-width="8" cx="80" cy="80" r="76" stroke-linecap="round" transform="rotate(-90 80 80)" />
                </svg>
                <span class="text">pass</span>
                <span class="num">0%</span>
            </div>
            <div id="money-total" class="input-box">
                <!-- <label for="total">平均過關收益:</label> -->
                <input type="text" id="total" value="0" readonly>
                <img class="money-img no1" src="images/money-l.png" alt="">
                <img class="money-img no2" src="images/money-r.png" alt="">
                <img class="money-img no3" src="images/money-l.png" alt="">
                <img class="money-img no4" src="images/money-r.png" alt="">
                <img class="money-img no5" src="images/money-l.png" alt="">
                <img class="money-img no6" src="images/money-r.png" alt="">
                <img class="money-img no7" src="images/money-l.png" alt="">
                <img class="money-img no8" src="images/money-r.png" alt="">
                <img class="money-img no9" src="images/money-l.png" alt="">
                <img class="money-img no10" src="images/money-r.png" alt="">
            </div>
        </div>
    </section>

    <footer>Copyright © 2023 XXX XXX XXXXX. All rights reserved.</footer>

</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
<script>
    // 获取 URL 参数字符串
    const queryString = window.location.search;

    // 移除 '?' 字符
    const paramsString = queryString.slice(1);

    // 拆分参数字符串为数组
    const paramsArray = paramsString.split('&');

    // 创建参数对象
    const params = {};

    // 解析参数数组
    paramsArray.forEach(param => {
    const [key, value] = param.split('=');
    params[key] = decodeURIComponent(value);
    });

    // 获取特定参数的值
    const deposit = params['deposit'];
    const bonus = params['bonus'];
    const turn = params['turn'];

    if(deposit && bonus && turn){
        $('#num1').val(deposit);
        $('#num2').val(bonus);
        $('#num3').val(turn);
        hendleButtonClick()
    }

    
    $(document).ready(function() {
        $('#operationform').submit(function(e) {
            e.preventDefault(); // 阻止表單提交
            hendleButtonClick()
        });
    });

    function handleKeyDown(event){
        if(event.keyCode ===13 || event.keyCode === 10){
            hendleButtonClick()
        }
    }

    function hendleButtonClick(event){
        var num1 = $('#num1').val();
        var num2 = $('#num2').val();
        var num3 = $('#num3').val();

        let checks = ["#num1", "#num2", "#num3"];
        let isChecks = isChecksnNull(checks);

        if(isChecks){
            $.ajax({
            url: 'operation.php',
            type: 'POST',
            data: {num1: num1, num2: num2, num3: num3},
            success: function(data) {
                $('#money-total').removeClass('show');
                $('.pass-box').removeClass('change');
                document.getElementById("total").value = '0';
                var data = JSON.parse(data);
                var num = 0;
                var passNum = data['passNum'];
                var sum = data['sum'];
                // console.log('passNum:' + passNum + 'sum' + sum)
                var interval = setInterval(function() {
                    document.querySelector(".num").textContent = num.toFixed(1) + '%';
                    circleNum = 477.6 - (477.6/100)*num
                    document.querySelector(".circle").style = "stroke-dashoffset:" + circleNum + ";";
                    num = num + 0.1;
                    moneyImg = document.querySelector('.money-img');
                    if (num > passNum) {
                        $('#money-total').addClass('show');
                        $('.pass-box').addClass('change');
                        clearInterval(interval);
                        // 計算兩數相加
                        document.getElementById("total").value = Math.floor(sum);
                        moneyNum = Math.round(sum/100);
                        for(let i=0; i<moneyNum; i++){
                            imgNum = i+1;
                            img = document.querySelector('.no' + imgNum);
                            img.classList.add("show");
                        }
                    }
                }, 5);
            },
            error: function(jqXHR, textStatus, errorThrown) {
                console.log(textStatus, errorThrown);
            }
            });
        }
    }

    function isChecksnNull(checks){
        return Boolean(checks
                    .filter(id => typeof $(id).val() === "string")
                    .filter(id => $(id).val() === "").length === 0)
    }

</script>
</html>